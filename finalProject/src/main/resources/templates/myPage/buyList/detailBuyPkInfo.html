<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="@{layouts/myPage_layout}">
<head>
<meta charset="UTF-8">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>

<title>문의사항</title>
<style type="text/css">
.hidden{
	border: none;
	text-align: center;
	margin: 0 auto;
}

body {
            background-color: #fff;
            font-family: 'Roboto', sans-serif;
            font-weight: 400;
            color: #333;
        }

 h1 {
     color: #333;
 }

 table {
     width: 100%;
     border-collapse: collapse;
     margin-bottom: 20px;
 }

 th, td {
     padding: 10px;
     border: 1px solid #ddd;
 }

 th {
     background-color: #f5f5f5;
 }
</style>
<script>

//환불 버튼 클릭 이벤트 처리
$(document).ready(function(){
	$("#refundBtn").click(function(){
		   Swal.fire({
				showCancelButton: true,
	       	title: '환불 하시겠습니까?',
			    icon: 'question',
				confirmButtonText: '확인',
				cancelButtonText: '취소',
		    }).then((firstResult) => {
		    	if(firstResult.value == true){
		    		let tid =  $(".tid").val();
		    		let cancelAmount = $(".cancelAmount").val();
		    		let cancelTaxFreeAmount = $(".cancelTaxFreeAmount").val();
		    		let orderDetailId = $(".orderId").val();
		    		let postId = '[[${list.postId}]]';
		    		let quantity = '[[${list.quantity}]]'
		    		let nowReservation = '[[${list.nowReservation}]]'-quantity;
		    		let maxReservation = '[[${list.nowReservation}]]'
					
					console.log(tid);
					console.log(cancelAmount);
					console.log(cancelTaxFreeAmount);
					
					$.ajax({
						type:'post',
						url:'/common/payment/refund',
						data:{
							tid: tid,
							cancelAmount : cancelAmount,
							cancelTaxFreeAmount : cancelTaxFreeAmount,
							orderDetailId : orderDetailId,
							postId : postId,
							quantity:quantity,
							nowReservation: nowReservation,
							maxReservation: maxReservation
						}
					}).done(data=>{
				        Swal.fire({
				        	title: '환불 되었습니다.',
						    icon: 'success',
						    confirmButtonText: '확인',
						    showCancelButton: false,
						    confirmButtonColor: '#3085d6',
						    cancelButtonColor: '#d33',
						    cancelButtonText: '확인',
						    reverseButtons: true,
				        }).then((firstResult) => {
							location.href="/common/refundPkList"
				        });
					}).fail(reject => console.log(reject));
			    }
			});
    })
});
</script>
</head>
<body>

	<div layout:fragment="content" style="text-align: center;">
	<div id="ls2">
	<form>
		<h5>주문 상세내역</h5>
		<br>
		<input type="hidden" class="orderId" th:value="${list.orderDetailId}">
		<input type="hidden" th:value="${list.cid}">	
		<input type="hidden" class="tid" th:value="${list.tid}">	
		<input type="hidden" class="cancelAmount" th:value="${list.cancelAmount}">	
		<input type="hidden" class="cancelTaxFreeAmount" th:value="${list.cancelTaxFreeAmount}"> 
		<table>
			<thead>
				<tr>
					<th style="width: 30%; padding: 0;">상품사진</th>
					<th colspan="2">상품명</th>
					<th style="width: 15%" colspan="">수량</th>
					<th style="width: 15%">상품금액</th>
				</tr>
			</thead>
			<tbody>
				<tr th:onclick="|location.href='@{/packageInfo(postId=${list.postId})}'|">
					<td style="width: 30%" rowspan="6">
						<img th:if="${not #strings.isEmpty(list.loadingImg)}" th:src="${list.loadingImg}" style="width:100%; height:200px;">
                    	<img th:unless="${not #strings.isEmpty(list.loadingImg)}" th:src="@{/img/no-image.png}">
					</td>
					<td th:text="${list.name}" colspan="2"></td>
					<td th:text="${list.quantity}" style="width: 15%"></td>
					<td th:text="${list.pkPrice}" style="width: 15%"></td>
				</tr>
				<tr>
					<th style="width: 100px"> 모집 상황 </th>
					<td colspan="3"  th:text="${list.completion}"></td>
				<tr>
				<tr>
					<th > 마감날짜 </th>
					<td colspan="3" th:text="${#dates.format(list.deadlineDate, 'yyyy-MM-dd')}"></td>
				<tr>
				<tr>
					<th > 총 금액 </th>
					<td colspan="3" th:text="${list.puPrice}+원" style="text-align: right;"></td>
				<tr>
			</tbody>
		</table>
		<br>
		<table>
			<thead>
				<tr>
					<td colspan="2" style="font-weight: bold;">결제정보</td>
				</tr>
			</thead>
			<tbody>
				<tr>
					<th style="width: 20%">결제금액</th>
					<td th:text="${list.puPrice}"></td>
				</tr>
				<tr>
					<th style="width: 20%">결제 상태</th>
					<td th:text="${list.orderStatus}"></td>
				</tr>
			
			</tbody>
		</table>
		<button type="button" id="refundBtn" class="feature-btn" th:if="${list.orderStatus != '환불 완료'}">환불</button>
		<button type="button" th:onclick="history.back()" class="feature-btn">목록으로</button>

	</form>
	</div>
	</div>

</body>
</html>