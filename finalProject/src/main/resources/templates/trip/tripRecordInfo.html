<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="@{layouts/default_layout}"
	layout:fragment="content">
<head>
<meta charset="UTF-8">
<title>여행기록 상세조회</title>
<!-- index.html 고유 CSS 추가 -->
<th:block layout:fragment="css"></th:block>
<!-- index.html 고유 스크립트 추가 -->
<th:block layout:fragment="script"></th:block>
<style>
body {
	background-color: #fff;
	font-family: 'Roboto', sans-serif;
	font-weight: 400;
	color: #333;
}

h1 {
	color: #333;
}

table {
	width: 100%;
	border-collapse: collapse;
	margin-bottom: 20px;
}

th, td {
	padding: 10px;
	text-align: left;
	border: 1px solid #ddd;
}

th {
	background-color: #f5f5f5;
}

textarea {
	width: 100%;
	padding: 10px;
	border: 1px solid #ddd;
	resize: none;
}

button {
	background-color: #333;
	color: #fff;
	border: none;
	padding: 10px 20px;
	cursor: pointer;
}

button:hover {
	background-color: #222;
}

p {
    padding: 5px;
    margin-bottom: 5px;
    margin-left : 10px;
}

table {
	width: 100%;
	border-collapse: collapse;
	margin-bottom: 20px;
	margin: 10px;
	padding: 10px;
}
.report-form {
    display: inline;
    background-color: #f2f2f2;
    padding: 10px;
    border-radius: 5px;
}

.report-form label {
    font-weight: bold;
}

.report-form select {
    width: 200px;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 3px;
}

.report-form input[type="submit"] {
    background-color: #333;
    color: white;
    padding: 8px 16px;
    border: 1px solid black;
    border-radius: 0;
    cursor: pointer;
}

.report-form input[type="submit"]:hover {
    background-color: #222;
}
</style>
</head>
<body>
	<div align="center">
		<br>
		<br>
		<h1>여행 기록 상세 조회</h1>
		<br>
	</div>
	<!-- 여행 기록 info & map 영역 -->
	<div id="ls2" align="center">
		<table border="1" style="width: 80%;">
			<tr>
				<th width="70">여행 지역</th>
				<td width="50" align="center" th:text="추가예정" ></td>
				<th width="100">작성자</th>
				<td width="150" align="center" th:text="${tripInfo.writerId}"></td>
				<th width="100">등록일자</th>
				<td width="150" align="center" th:text="${#dates.format(tripInfo.registDay, 'yy년 MM월 dd일 hh:mm:ss')}"></td>
				<th width="100">조회수</th>
				<td width="70" align="center" th:text="추가예정"></td>
			</tr>
			<tr>
				<th colspan="2">여행 타이틀</th>
				<td colspan="6" align="center" th:text="${tripInfo.tripTitle}">
				</td>
			</tr>
			<tr>
				<th colspan="2">여행 일자</th>
				<td colspan="6" align="center">[[${#dates.format(tripInfo.startDay, 'yy년 MM월 dd일')}]] ~ [[${#dates.format(tripInfo.endDay, 'yy년 MM월 dd일')}]]</td>
			</tr>
		</table>
		<div class="map_wrap" style="height: 800px; width: 700px; border: solid 1px;">
         	<div id="map"style="width: 100%; height: 100%; position: relative; overflow: hidden;">
         	</div>
        </div>
	</div>
	<!-- 여행 경로, 메모 영역 -->
	<div align="center">
		<div style="text-align: center;">
         	<h5>여행 경로</h5>
			<div th:each="mp : ${mapInfo}">
				순번 : [[${mp.mapNo}]] 장소명 : [[${mp.mapName}]]
				<h3> ----------</h3>
			</div>
			<h5>여행 메모</h5>
			<div th:each="mo : ${memoInfo}">
				내용 : [[${mo.content}]]
				<h3> ----------</h3>
			</div>
			<button type="button" onclick="location.href='/tripRecordList'">목록으로</button>
			<br>
		</div>
	</div>
	
	<script th:inline="javascript">
		//마커를 담을 배열
		var markers = [];
		//db에 저장된 좌표를 담아줄 배열
		var mapping = [];
		//생성된 마커를 연결하는 선 
		var polyline = null;
		
		// 지도를 표시
		var mapContainer = document.getElementById('map'), mapOption = {
	    	// 최초로 생성된 지도의 중심좌표 
	    	center : new kakao.maps.LatLng(35.1531932736837, 129.118976093583),
	        // 지도의 확대 레벨
	        level : 8
	    };
		
		// 지도 생성 
        var map = new kakao.maps.Map(mapContainer, mapOption);
			
        // 마커를 생성하고 지도 위에 마커를 표시하는 함수
        function addMarker(position, idx, title) {
        	// 마커 이미지 url, 스프라이트 이미지 사용
        	var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png', 
                imageSize = new kakao.maps.Size(36, 37), // 마커 이미지의 크기
                imgOptions = {
                  spriteSize : new kakao.maps.Size(36, 691), // 스프라이트 이미지의 크기
                  spriteOrigin : new kakao.maps.Point(0, (idx * 46) + 10), // 스프라이트 이미지 중 사용할 영역의 좌상단 좌표
                  offset : new kakao.maps.Point(13, 37)
                  // 마커 좌표에 일치시킬 이미지 내에서의 좌표
               	}, markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imgOptions), marker 
               				   = new kakao.maps.Marker({
                        	   		position : position, // 마커의 위치
                        		    image : markerImage
                     			});

             marker.setMap(map); // 지도 위에 마커를 표출
             markers.push(marker); // 배열에 생성된 마커를 추가

             return marker;
         }
         
         //DB에서 가져온 map 데이터
         var mapList = [[${mapInfo}]];
         	
         //여행 경로 데이터에서 받아온 장소 데이터를 통해 지도위에 마커 생성
         var first_positions = [];
         $.each(mapList, function (index, obj){
         	let object = {};
         	object["content"] = obj.mapName;
         	object["latlng"] = new kakao.maps.LatLng(obj.mapLat, obj.mapLng);
         		
         	first_positions.push(object);
         });
         	
         for (var i = 0; i < first_positions.length; i++) {
         	// 마커를 생성합니다
            var marker = new kakao.maps.Marker({
            	map : map, // 마커를 표시할 지도
                position : first_positions[i].latlng
             });

             // 마커에 표시할 인포윈도우를 생성
             var infowindow = new kakao.maps.InfoWindow({
             	 content : first_positions[i].content, // 인포윈도우에 표시할 내용
                 removable : true
             });

             kakao.maps.event.addListener(marker, 'click', marker_click(map, marker, infowindow));
             }

         
          function marker_click(map, marker, infowindow) {
          	 return function() {
            	infowindow.open(map, marker);
             };
          }
          
             
          //선을 구성하는 좌표 배열 이 좌표들을 이어서 선을 표시
          var first_polyline = []
          //여행 경로 데이터에서 받아온 장소 데이터를 통해 마커 사이에 선을 생성
		  $.each(mapList, function (index, obj){
          	 let object2 = {};
         	 object2 = new kakao.maps.LatLng(obj.mapLat, obj.mapLng),
         	 first_polyline.push(object2);
         		
          });
           

          // 지도에 표시할 선을 생성합니다
          var first_linePath = new kakao.maps.Polyline({
          	 path : first_polyline, // 선을 구성하는 좌표 배열
             strokeWeight : 3, // 선의 두께
             strokeColor : 'black', // 선의 색깔
             strokeOpacity : 0.7, // 선의 불투명도 (1에서 0 사이의 값, 0에 가까울수록 투명)
             strokeStyle : 'solid' // 선의 스타일

          });
             
          // 지도에 마커를 표시
          marker.setMap(map);
          
          // 선 생성 
          first_linePath.setMap(map);
          
	</script>	
</body>
</html>