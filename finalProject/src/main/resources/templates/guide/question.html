<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="@{layouts/myPage_layout}">
<head>
<meta charset="UTF-8">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>

<title>문의사항</title>
<style type="text/css">
table, th,td {
	border: 1px solid black;
	text-align: center;
	margin: 0 auto;
}
.hidden{
	border: none;
	text-align: center;
	margin: 0 auto;
	display:none;
}

}
</style>
<script>
$(document).ready(function() {
	let list = [];
    
    $('.answer').click(function(){
        var tr = $(this).closest('tr'); // 부모 <tr> 요소 선택
        var hiddenRows = tr.nextAll('.hidden:first, .hidden:eq(1)');
        
        if (hiddenRows.is(':visible')) {
            hiddenRows.hide();
        } else {
            hiddenRows.show();
        }
    });
     //미답변 입력
    $('.insert').click(function(){
    	var tr = $(this).closest('tr');
    	var td = tr.parent();
    	
    	var answerContent = tr.find('textarea').val();
    	var questionId = tr.prev().prev().find('input[type=hidden]');
    	console.log(answerContent);
    	console.log(questionId);
    	
    	var obj = {};
        obj["questionId"] = questionId; // question_id 값을 설정
        obj["answerContent"] = answerContent;
        
    	
    	console.log(obj);
    	
    	$.ajax({
            url: '/common/queInsert',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify(obj) // JSON 응답 처리 설정
        }).done(data => {
            console.log(data);
            top.document.location.reload();
            
        }).fail(reject => console.log(reject));
    });
     //업데이트
    $('.update').click(function(){
    	var tr = $(this).closest('tr');
    	var td = tr.parent();
    	
    	var answerContent = tr.find('input[type=text]').val();
    	var answerId = tr.prev().prev().find('input[type=hidden]').val();
    	
    	var obj = {};
        obj["answerId"] = answerId; // question_id 값을 설정
        obj["answerContent"] = answerContent;
        
    	
    	console.log(obj);
    	
    	$.ajax({
            url: 'queUpdate',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify(obj) // JSON 응답 처리 설정
        }).done(data => {
            console.log(data);
            top.document.location.reload();
        }).fail(reject => console.log(reject));
  
    });
});
</script>
</head>
<body>

	<th:block layout:fragment="css"></th:block>
	<th:block layout:fragment="script"></th:block>
	<div layout:fragment="content" style="text-align: center;">
	<form>
		<table>
			<thead>
				<tr>
					<th>작성일</th>
					<th>답변일</th>
					<th>답변여부</th>
				</tr>
			</thead>
			<tbody>
				<th:block th:each="que, queStat : ${guideQue}">
					<tr class="question">
						<td th:if="${que.answerModifyDate == null}" th:text="${que.questionType}" th:value="${que.questionId}"></td>
						<td th:if="${que.answerModifyDate != null}" th:text="${que.questionType(수정됨)}"></td>
						<td th:text="${que.questionDate}"></td>
						<td th:if="${que.answerDate == null}">답변이 없습니다</td>
						<td th:if="${que.answerModifyDate == null and que.answerDate != null}" th:value="${que.answerDate}">
						<td th:if="${que.answerModifyDate != null}" th:value="${que.answerModifyDate}"></td>
						<td th:if="${que.answerContent == null}" class="answer">미답변</td>
						<td th:if="${que.answerContent != null}" class="answer" >답변완료</td>
					</tr>		
					<tr class="hidden">
						<td colspan="4">
							<label>내용</label>
							<th:textarea rows="9" cols="70" readonly="readonly">[[${que.questionContent}]]</th:textarea>
						</td>
					</tr>
					<tr class="hidden">
						<td colspan="4">
							<label>답변</label>
							<textarea rows="9" cols="70">[[${que.answerContent}]]</textarea>
							<br><button type="reset">취소</button>
							<button type="button" class="insert" th:if="${que.answerContent == null}">등록</button>
							<button type="button" class="update" th:if="${que.answerContent != null}">수정</button>
										
						</td>
					</tr>
					
				</th:block>
					</tbody>
			</table>
		</form>
		<div class="property-pagination">
			<th:block th:if="${paging.startPage != 1}">
				<a th:href="@{/guide/guideQue(nowPage=1, cntPerPage=${paging.cntPerPage})}"><<</a>
			</th:block>
			<th:block th:if="${paging.startPage != 1}">
				<a
					th:href="@{/guide/guideQue(nowPage=${paging.startPage - 1}, cntPerPage=${paging.cntPerPage})}">&lt;</a>
			</th:block>
			<th:block
				th:each="p : ${#numbers.sequence(paging.startPage, paging.endPage)}">
				<th:block th:if="${p eq paging.nowPage}">
					<b th:text="${p}"></b>
				</th:block>
				<th:block th:if="${p ne paging.nowPage}">
					<a
						th:href="@{/guide/guideQue(nowPage=${p}, cntPerPage=${paging.cntPerPage})}"
						th:text="${p}"></a>
				</th:block>
			</th:block>
			<th:block th:if="${paging.endPage != paging.lastPage}">
				<a
					th:href="@{/guide/guideQue(nowPage=${paging.endPage + 1}, cntPerPage=${paging.cntPerPage})}">&gt;</a>
			</th:block>
			<th:block th:if="${paging.endPage != paging.lastPage}">
				<a
					th:href="@{/guide/guideQue(nowPage=${paging.lastPage}, cntPerPage=${paging.cntPerPage})}">>></a>
			</th:block>
		</div>
	</div>
</body>
</html>