<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.trip.finalProject.question.mapper.QuestionMapper">
  	 <!-- 페이징 -->
 	<select id="getTotalCount" resultType="int">
 		SELECT COUNT(*)
 		FROM question
 		WHERE answer_member_id = #{answerMemberId}
 	</select>
 	<!-- 전체조회 -->
 	<select id="selectAllQue" resultType="QuestionVO">
	SELECT *
	FROM (
	    SELECT ROWNUM rn, a.*
	    FROM (
	        SELECT
	            question_id,
	            question_type,
	            question_content,
	            question_date,
	            questionId,
	            memebr_id,
	            answer_result
	            answer_id,
	            answer_content,
	            answer_date,
	            answer_modify_date,
	            answer_member_id
	        FROM
	            question
	        ORDER BY
	            q.question_date DESC
	        where answer_member_id = #{answerMemberId}
	    ) a
	) WHERE rn BETWEEN #{start} AND #{end}
 	</select>
 	<!-- 입력 -->
 	<insert id="insertQue" parameterType="QuestionVO">
 		<selectKey keyProperty="answerId" resultType="String" order="BEFORE">
			SELECT 'ANS' || (TO_NUMBER(NVL((SUBSTR(MAX(answer_id), 4)), (TO_CHAR(SYSDATE, 'YYMMDD') || '0000'))) + 1)
			FROM question_answer
			WHERE SUBSTR(answer_id, 4, 6) = TO_CHAR(SYSDATE, 'YYMMDD')
		</selectKey>
		INSERT INTO question
					(
					answer_id,
					answer_content,
					answer_date
					)
				VALUES
					(
					#{answerId},
					#{answerContent},
					sysdate
					)
 	</insert>
 	<!-- 수정 -->
 	<update id="updateQue" parameterType="QuestionVO">
	 	update question_answer
	 	<set>
	 		answer_contexts = #{answerContexts},
	 		answer_modify_date = sysdate
	 	</set>
		where answer_id = #{answerId}
 	</update>
 	<!-- 일반사용자 구성 -->
 	<!-- 페이징 -->
 	<select id="getTotalMember" resultType="int">
 	 	SELECT COUNT(*)
 		FROM question
 	</select>
 	
 	<!-- 전체조회 -->
 	<select id="selectAllQueMember" resultType="QuestionVO">
	SELECT *
	FROM (
	    SELECT ROWNUM rn, a.*
	    FROM (
	        SELECT
	            question_id,
	            question_type,
	            question_content,
	            question_date,
	            questionId,
	            memebr_id,
	            answer_result
	            answer_id,
	            answer_content,
	            answer_date,
	            answer_modify_date,
	            answer_member_id
	        FROM
	            question
	        ORDER BY
	            q.question_date DESC
	        where member_id = #{memberId}
	    ) a
	) WHERE rn BETWEEN #{start} AND #{end}
 	</select>
  
  </mapper>