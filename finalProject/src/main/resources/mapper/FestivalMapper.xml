<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

  <mapper namespace="com.trip.finalProject.festival.mapper.FestivalMapper">
    <insert id="getFestivalInfoAndSave" parameterType="java.util.List">
        <foreach collection="list" item="festival" separator=" " open="BEGIN" close="END;">
            MERGE INTO festival_info f
            USING dual
            ON (f.content_id = #{festival.contentId})
            WHEN MATCHED THEN
            UPDATE SET
            f.area_code = #{festival.areaCode},
            f.sigungu_code = #{festival.sigunguCode},
            f.festival_name = #{festival.festivalName},
            f.start_date = #{festival.startDate},
            f.end_date = #{festival.endDate},
            f.festival_img = #{festival.festivalImg},
            f.address = #{festival.address},
            f.save_date = SYSDATE
            WHEN NOT MATCHED THEN
            INSERT (
            festival_id,
            area_code,
            sigungu_code,
            festival_name,
            start_date,
            end_date,
            festival_img,
            content_id,
            address,
            save_date
            )
            VALUES (
            #{festival.festivalId},
            #{festival.areaCode},
            #{festival.sigunguCode},
            #{festival.festivalName},
            #{festival.startDate},
            #{festival.endDate},
            #{festival.festivalImg},
            #{festival.contentId},
            #{festival.address},
            SYSDATE
            );
        </foreach>
    </insert>

    <!-- where 절로 deleteYN이 N인 것만 받기 -->
	<select id="getFestivalCalendarInfo" resultType="FestivalInfoVO">
        SELECT *
       	FROM festival_info
   </select>

    <!-- 매일 오후 11시 50분쯤에 스케쥴러 돌리고, updateDate는 SYSDATE로 -->

<!--    <select id="selectSpotDetailReview" resultType="SpotDetailReviewVO">-->
<!--   SELECT *       FROM(SELECT ROWNUM rn, a.*             FROM(-->
<!--      SELECT *-->
<!--        FROM review-->
<!--       WHERE origin_post_id = #{contentId}-->
<!--       ORDER BY review_id DESC-->
<!--   ) a			 )        WHERE rn BETWEEN (#{page }*5-4) AND (#{page }*5)-->
<!--    </select>-->

   
<!--    <insert id="insertReviewInfo" parameterType="SpotDetailReviewVO">-->
<!--        <selectKey keyProperty="reviewId" resultType="String" order="BEFORE">-->
<!--            SELECT 'RIV' || (TO_NUMBER(NVL((SUBSTR(MAX(review_id), 4)), (TO_CHAR(SYSDATE, 'YYMMDD') || '0000'))) + 1)-->
<!--			FROM review-->
<!--			WHERE SUBSTR(review_id, 4, 6) = TO_CHAR(SYSDATE, 'YYMMDD')-->
<!--        </selectKey>-->
<!--        INSERT INTO review (review_id, -->
<!--                            writer_id, -->
<!--                            review_type, -->
<!--                            origin_post_id, -->
<!--                            grade, -->
<!--                            content, -->
<!--                            write_date)-->
<!--              VALUES (#{reviewId},-->
<!--                      #{writerId}, -->
<!--                      'E1', -->
<!--                      #{originPostId}, -->
<!--                      #{grade}, -->
<!--                      #{content}, -->
<!--                      sysdate)-->
<!--    </insert>-->

<!--    <delete id="deleteReview" parameterType="SpotDetailReviewVO">-->
<!--        DELETE FROM review-->
<!--        WHERE review_id=#{reviewId}-->
<!--    </delete>-->

  </mapper>